<!doctype html>
<html>
<head>
    <title>HS icon swapper</title>
    <style>
    body { font: 13px Helvetica, Arial; }
    .status {position: absolute; top: 1%; right: 1%; background-color: #ddd; padding: 5px; border-radius: 4px; opacity: 0.5; color: #000;}
    .player1, .player2 { float: left; padding: 20px; margin: 20px; }
    .player1 {border: 1px solid blue;}
    .player2 {border: 1px solid red;}
    label { float: left; }
    input[type="checkbox"] { float: right; }
    .clear { clear: both; }
    </style>
</head>
<body>
    <div class="status"></div>

    <div class="player1">
        <select class="list">
            <option>-</option>
        </select>
        <div class="name">-</div>
        <div class="hero1"><label>-</label><input type="checkbox" /></div>
        <div class="clear"></div>
        <div class="hero2"><label>-</label><input type="checkbox" /></div>
        <div class="clear"></div>
        <div class="hero3"><label>-</label><input type="checkbox" /></div>
    </div>

    <div class="player2">
        <select class="list">
            <option>-</option>
        </select>
        <div class="name">-</div>
        <div class="hero1"><label>-</label><input type="checkbox" /></div>
        <div class="clear"></div>
        <div class="hero2"><label>-</label><input type="checkbox" /></div>
        <div class="clear"></div>
        <div class="hero3"><label>-</label><input type="checkbox" /></div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.3.7.js"></script>
    <script>
        var socket = io();

        var heroes = [
            '',
            'warrior',
            'hunter',
            'mage',
            'warlock',
            'shaman',
            'rogue',
            'druid',
            'paladin',
            'priest'
        ];

        socket.on('status', function(msg){
            $('.status').text(msg);
        });

        $('.list').on('change', function() {
            $.each($('input[type="checkbox"]'), function(k,v) {
                $(v).attr('checked', false);
            });

            updateIcons($(this).parent());
        });

        $('input[type="checkbox"').on('change', function() {
            updateIcons($(this).parent().parent());
        })

        function updateIcons(element) {
            var data = element.find('.list').val().split(';');

            element.find('.name').text(data[0]);

            for (i=1; i<=3; ++i) {
                element.find('.hero'+i+' label').html(data[i]);
            }

            if (data[1] == '-') {
                return false;
            }

            if (element.hasClass('player1')) {
                data.unshift(1);
            }
            else {
                data.unshift(2);
            }
        
            for(i=1; i<=3; ++i) {
                data[4+i] = $('.player'+data[0]+' .hero'+i+' input[type="checkbox"').is(':checked');
            }

            console.log(data);

            socket.emit('updateIcons', data);
        }

        $.ajax({
            url: 'http://dev.pcesports.com/run/hslist/haosdi012',
            type: 'GET',
            success: function(data) {
                var html = '<option value="-;-;-;-">-</option>';
                data = $.parseJSON(data);
                $.each(data, function(k,v) {
                    html += '<option value="'+v.name+';'+heroes[v.contact_info.hero1]+';'+heroes[v.contact_info.hero2]+';'+heroes[v.contact_info.hero3]+'">'+v.name+'</option>';
                });
                $('.list').html(html);
            },
            error: function() {
                alert('Error fetching users');
            }
        });
    </script>
    </body>
</html>